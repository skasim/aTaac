#!/bin/bash

# metasploit resource scripts are currently stored in /exploits/ and each exploit has its own folder. the folder name is the attack_id from the commands database

# the following *.RC files exist in /exploits/[attack_id]:
# [attack_id]_.rc --> FULL exploit (all requisite commands, use + set(s) + exploit)
# [attack_id]_use.rc --> only use command
# [attack_id]_set.rc --> all set commands
# [attack_id]_use+set.rc --> all use AND set commands
# [attack_id]_exploit.rc --> only exploit/run command

# this script does the following:
# (1) pull all *.RC files into the parent directory, /exploits/
# (2) replace Nawal's target machine IP address with "target_address"
# (3) replace Nawal's Kali machine IP address with "kali_address"
# (4) replace "target_address" with MYMETASPLOITABLE variable, which should be set to the CLOUD target machine IP address
# (5) replace "kali_address" with MYKALI variable, which should be set to the CLOUD Kali machine IP address

# to run the script:
# (1) open a terminal in the directory with this script and /exploits/
# (2) in the terminal, enter "chmod +x aggregate.sh" and hit enter. this adds executable permissions to the script file
# (3) in the terminal, enter "./aggregate.sh" and hit enter, the script should run
# the original, unadulterated scripts will still remain in /exploits/[attack_id]. these act as a backup should something go wrong in the find+replace process.
# the scripts to use on the cloud will be copied and modified and stored in /exploits/
# (4) let it rip!

find . -mindepth 2 -type f -print -exec cp {} . \; # find all files in subdirectory and copy them to parent folder
sed -i 's/192.168.56.101/target_address/g' *.rc    # replace nawal's metasploitable ip with "target_address"
sed -i 's/10.0.2.15/kali_address/g' *.rc           # replace nawal's kali ip with "kali_address"
MYMETASPLOITABLE=metasploitable_snort              # enter the ip of the cloud metasploitable image
MYKALI=kali-everything-rc2                         # enter the ip of the cloud kali linux image 
sed -i "s/target_address/$MYMETASPLOITABLE/g" *.rc # replace all placeholder strings with cloud metasploitable image ip
sed -i "s/kali_address/$MYKALI/g" *.rc             # replace all placeholder strings with cloud kali image ip